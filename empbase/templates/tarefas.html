{% load static %}
{% include 'header.html' %}
{% include 'links.html' %}

{% if user.is_superuser %}
    <div class="accordion borda">
        <div class="accordion-main flexstart">
            <p><i class="fa-solid fa-file-import" style="color: #6da5f8"></i> Importar arquivo:</p>
        </div>
        <div class="accordion-content hidden">
            <div id="dragNdrop" class="dragNdrop">
                <div>
                    <form id="uploadarquivo">
                        <input id="modelo" type="hidden" value="impostos">
                        <label for="arquivo">Clique para adcionar ou solte o arquivo</label>
                        <input id="arquivo" name="arquivo" type="file">
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<div class="abasgrupo">
    {% if user.is_superuser or user.eh_supervisor %}
        <p class="abasmenu abaativa">Impostos</p><p class="abasmenu">Holerite</p>
    {% endif %}
    {% for pg in fpagamento %}
        <p class="abasmenu">{{ pg.tipo|lower|capfirst }}</p>
    {% endfor %}
</div>
<!-- aba de impostos-->
<div class="abas">
<button class="btn-rounded-big btn-green" style="position: fixed; bottom: 0.5rem; right: 0.5rem;" onclick="mostrar(this)"><i class="fa-solid fa-plus"></i></button>
<div class="formdisplay hidden">
    <div>
        <div class="forminput_barra">
            <button onclick="removefundo()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="formgroup">
            <form>
                <div class="forminput">
                    <label for="empresa">Empresa: </label>
                    <select name="empresa" id="empresa">
                        <option value="" selected>-----</option>
                        {% for emp in emps %}
                            <option value="{{emp.id}}">{{emp.nome}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="forminput">
                    <label for="nomeimposto">Imposto: </label>
                    <input type="text" name="nomeimposto" id="nomeimposto">
                </div>
                <div class="forminput">
                    <label for="valorimposto">Valor:</label>
                    <input type="text" name="valorimposto" id="valorimposto">
                </div>
                <div class="forminput">
                    <label for="compimposto">Competência:</label>
                    <input type="text" name="compimposto" id="compimposto">
                </div>
                <div class="forminput">
                    <label for="vctoimposto">Vencimento:</label>
                    <input type="date" name="vctoimposto" id="vctoimposto">
                </div>
            </form>
            <button class="btn">Adcionar <i class="fa-solid fa-plus"></i></button>
        </div>
    </div>
</div>
{% for emp in imposto %}
    {% with imp=emp.imposto_set.all|dictsort:'nome' %}
        <div class="" style="margin: 0.5rem; border-left: 4px solid #939b9f">
            <p style="margin: 0.3rem;">{{ emp.cod }} - {{ emp.nome }}</p>
            <div class="flexstart">
                {% for imp in imp %}
                    {% if imp.comp == ua.comp %}
                        <div class="borda" style="padding: 0.3rem; margin: 0.5rem;">
                            <p>{{ imp.nome }}</p>
                            <p>Competência: {{ imp.comp.month }}/{{ imp.comp.year }} </p>
                            <p>R$ {{ imp.valor }}</p>
                            <p>VCTO: {{ imp.vcto|date:"d/m/Y" }}</p>   
                            <div {% if imp.enviado == True %} class="confere csuccess" {% else %} class="confere borda cdanger" {% endif %} id="{{ imp.id }}" onclick="enviado(this)">
                                <span>Status: </span>{% if imp.enviado == True %} <i class="fa-solid fa-check"></i> {% else %} <i class="fa-regular fa-paper-plane"></i> {% endif %}</i>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endwith %}
{% endfor %}
</div>
    <!-- aba de holerite-->
<div class="abas hidden">
    {% for emp in holerite %}
        <div class="borda" style="margin: 0.5rem;">
            <p style="margin: 0.3rem;">{{ emp.cod }} - {{ emp.nome }}</p>
            <div class="flexstart">
                {% for holerite in emp.holerite_set.all %}
                    {% if holerite.comp == ua.comp %}
                                <div class="borda" style="padding: 0.3rem; margin: 0.5rem;">
                                    <p class="padding-sm">{{ holerite.tipo }}</p>
                                    <p>Competência: {{holerite.comp.month}}/{{holerite.comp.year}}</p>
                                    <div {% if holerite.enviado == True %} class="confere csuccess" {% else %} class="confere borda cdanger" {% endif %} id="{{ holerite.id }}" onclick="holerite(this)">
                                        <span>Status: </span>{% if holerite.enviado == True %} <i class="fa-solid fa-check"></i> {% else %} <i class="fa-regular fa-paper-plane"></i> {% endif %}</i>
                                    </div> 
                                </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>
    <!-- aba de pagamento dos funcionarios -->
    {% for pg in fpagamento %}
        {% with funcs=pg.funcs.get_queryset %}
            <div class="abas hidden" style="margin: 0 auto; max-width: 85rem; display: flex; flex-wrap: wrap;">
                {% for funpg in funcs|dictsort:"func.nome" %}
                <div class="borda padding-sm" style="height: 8rem; display: flex; flex-wrap: wrap; align-items: stretch; justify-content: center; align-content: space-between; width:16rem; margin: 0.5rem;">
                    <p style="text-align: center;">{{ funpg.func.nome }}</p>
                    <div {% if funpg.pago == True %} class="confere csuccess" {% else %} class="confere borda cdanger" {% endif %} id="{{ funpg.id }}" onclick="pagamento(this, pagamento)" style="height: 2.5rem;">
                        <span>Pago:</span>
                        {% if funpg.pago == True %} <i class="fa-solid fa-hand-holding-dollar"></i> {% else %} <i class="fa-solid fa-money-check-dollar"></i> {% endif %}                        
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endwith %}
    {% endfor %}
</div>
{% include 'footer.html' %}
<script src="{% static 'js/processa.js' %}"></script>
</html>